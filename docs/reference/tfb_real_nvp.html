<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>RealNVP affine coupling layer for vector-valued events — tfb_real_nvp • tfprobability</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="RealNVP affine coupling layer for vector-valued events — tfb_real_nvp" />
<meta property="og:description" content="Real NVP models a normalizing flow on a D-dimensional distribution via a
single D-d-dimensional conditional distribution (Dinh et al., 2017):
y[d:D] = x[d:D] * tf.exp(log_scale_fn(x[0:d])) + shift_fn(x[0:d])
y[0:d] = x[0:d]
The last D-d units are scaled and shifted based on the first d units only,
while the first d units are 'masked' and left unchanged. Real NVP's
shift_and_log_scale_fn computes vector-valued quantities.
For scale-and-shift transforms that do not depend on any masked units, i.e.
d=0, use the tfb_affine bijector with learned parameters instead.
Masking is currently only supported for base distributions with
event_ndims=1. For more sophisticated masking schemes like checkerboard or
channel-wise masking (Papamakarios et al., 2016), use the tfb_permute
bijector to re-order desired masked units into the first d units. For base
distributions with event_ndims &amp;gt; 1, use the tfb_reshape bijector to
flatten the event shape." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tfprobability</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/dynamic_linear_models.html">Dynamic linear models</a>
    </li>
    <li>
      <a href="../articles/hamiltonian_monte_carlo.html">Multi-level modeling with Hamiltonian Monte Carlo</a>
    </li>
    <li>
      <a href="../articles/layer_dense_variational.html">Uncertainty estimates with layer_dense_variational</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rstudio/tfprobability">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>RealNVP affine coupling layer for vector-valued events</h1>
    <small class="dont-index">Source: <a href='https://github.com/rstudio/tfprobability/blob/master/R/bijectors.R'><code>R/bijectors.R</code></a></small>
    <div class="hidden name"><code>tfb_real_nvp.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Real NVP models a normalizing flow on a D-dimensional distribution via a
single D-d-dimensional conditional distribution (Dinh et al., 2017):
<code>y[d:D] = x[d:D] * tf.exp(log_scale_fn(x[0:d])) + shift_fn(x[0:d])</code>
<code>y[0:d] = x[0:d]</code>
The last D-d units are scaled and shifted based on the first d units only,
while the first d units are 'masked' and left unchanged. Real NVP's
shift_and_log_scale_fn computes vector-valued quantities.
For scale-and-shift transforms that do not depend on any masked units, i.e.
d=0, use the tfb_affine bijector with learned parameters instead.
Masking is currently only supported for base distributions with
event_ndims=1. For more sophisticated masking schemes like checkerboard or
channel-wise masking (Papamakarios et al., 2016), use the tfb_permute
bijector to re-order desired masked units into the first d units. For base
distributions with event_ndims &gt; 1, use the tfb_reshape bijector to
flatten the event shape.</p>
    </div>

    <pre class="usage"><span class='fu'>tfb_real_nvp</span>(<span class='no'>num_masked</span>, <span class='no'>shift_and_log_scale_fn</span>,
  <span class='kw'>is_constant_jacobian</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>validate_args</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>name</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>num_masked</th>
      <td><p>integer indicating that the first d units of the event
should be masked. Must be in the closed interval <code>[1, D-1]</code>, where D
is the event size of the base distribution.</p></td>
    </tr>
    <tr>
      <th>shift_and_log_scale_fn</th>
      <td><p>Function which computes shift and log_scale from both the
forward domain (x) and the inverse domain (y).
Calculation must respect the "autoregressive property". Suggested default:
<code><a href='tfb_real_nvp_default_template.html'>tfb_real_nvp_default_template(hidden_layers=...)</a></code>.
Typically the function contains <code>tf$Variables</code> and is wrapped using <code>tf$make_template</code>.
Returning NULL for either (both) shift, log_scale is equivalent to (but more efficient than) returning zero.</p></td>
    </tr>
    <tr>
      <th>is_constant_jacobian</th>
      <td><p>Logical, default: FALSE. When TRUE the implementation assumes log_scale
does not depend on the forward domain (x) or inverse domain (y) values.
(No validation is made; is_constant_jacobian=FALSE is always safe but possibly computationally inefficient.)</p></td>
    </tr>
    <tr>
      <th>validate_args</th>
      <td><p>Logical, default FALSE. Whether to validate input with asserts. If validate_args is
FALSE, and the inputs are invalid, correct behavior is not guaranteed.</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>name prefixed to Ops created by this class.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Recall that the MAF bijector (Papamakarios et al., 2016) implements a
normalizing flow via an autoregressive transformation. MAF and IAF have
opposite computational tradeoffs - MAF can train all units in parallel but
must sample units sequentially, while IAF must train units sequentially but
can sample in parallel. In contrast, Real NVP can compute both forward and
inverse computations in parallel. However, the lack of an autoregressive
transformations makes it less expressive on a per-bijector basis.</p>
<p>A "valid" shift_and_log_scale_fn must compute each shift (aka loc or
"mu" in Papamakarios et al. (2016) and log(scale) (aka "alpha" in
Papamakarios et al. (2016)) such that each are broadcastable with the
arguments to forward and inverse, i.e., such that the calculations in
forward, inverse below are possible. For convenience,
real_nvp_default_nvp is offered as a possible shift_and_log_scale_fn function.</p>
<p>NICE (Dinh et al., 2014) is a special case of the Real NVP bijector
which discards the scale transformation, resulting in a constant-time
inverse-log-determinant-Jacobian. To use a NICE bijector instead of Real
NVP, shift_and_log_scale_fn should return (shift, NULL), and
is_constant_jacobian should be set to TRUE in the RealNVP constructor.
Calling tfb_real_nvp_default_template with shift_only=TRUE returns one such
NICE-compatible shift_and_log_scale_fn.</p>
<p>Caching: the scalar input depth D of the base distribution is not known at
construction time. The first call to any of forward(x), inverse(x),
inverse_log_det_jacobian(x), or forward_log_det_jacobian(x) memoizes
D, which is re-used in subsequent calls. This shape must be known prior to
graph execution (which is the case if using <code>tf$layers</code>).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    

<ul>
<li><p><a href='https://arxiv.org/abs/1705.07057'>George Papamakarios, Theo Pavlakou, and Iain Murray. Masked Autoregressive Flow for Density Estimation. In Neural Information Processing Systems, 2017.</a></p></li>
<li><p><a href='https://arxiv.org/abs/1605.08803'>Laurent Dinh, Jascha Sohl-Dickstein, and Samy Bengio. Density Estimation using Real NVP. In International Conference on Learning Representations, 2017.</a></p></li>
<li><p><a href='https://arxiv.org/abs/1410.8516'>Laurent Dinh, David Krueger, and Yoshua Bengio. NICE: Non-linear Independent Components Estimation.arXiv preprint arXiv:1410.8516,2014.</a></p></li>
<li><p><a href='http://blog.evjang.com/2018/01/nf2.html'>Eric Jang. Normalizing Flows Tutorial, Part 2: Modern Normalizing Flows. Technical Report_, 2018.</a></p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>For usage examples see <code><a href='tfb_forward.html'>tfb_forward()</a></code>, <code><a href='tfb_inverse.html'>tfb_inverse()</a></code>, <code><a href='tfb_inverse_log_det_jacobian.html'>tfb_inverse_log_det_jacobian()</a></code>.</p>
<p>Other bijectors: <code><a href='tfb_absolute_value.html'>tfb_absolute_value</a></code>,
  <code><a href='tfb_affine_linear_operator.html'>tfb_affine_linear_operator</a></code>,
  <code><a href='tfb_affine_scalar.html'>tfb_affine_scalar</a></code>,
  <code><a href='tfb_affine.html'>tfb_affine</a></code>,
  <code><a href='tfb_batch_normalization.html'>tfb_batch_normalization</a></code>,
  <code><a href='tfb_blockwise.html'>tfb_blockwise</a></code>, <code><a href='tfb_chain.html'>tfb_chain</a></code>,
  <code><a href='tfb_cholesky_outer_product.html'>tfb_cholesky_outer_product</a></code>,
  <code><a href='tfb_cholesky_to_inv_cholesky.html'>tfb_cholesky_to_inv_cholesky</a></code>,
  <code><a href='tfb_correlation_cholesky.html'>tfb_correlation_cholesky</a></code>,
  <code><a href='tfb_discrete_cosine_transform.html'>tfb_discrete_cosine_transform</a></code>,
  <code><a href='tfb_expm1.html'>tfb_expm1</a></code>, <code><a href='tfb_exp.html'>tfb_exp</a></code>,
  <code><a href='tfb_fill_triangular.html'>tfb_fill_triangular</a></code>,
  <code><a href='tfb_gumbel.html'>tfb_gumbel</a></code>, <code><a href='tfb_identity.html'>tfb_identity</a></code>,
  <code><a href='tfb_inline.html'>tfb_inline</a></code>, <code><a href='tfb_invert.html'>tfb_invert</a></code>,
  <code><a href='tfb_kumaraswamy.html'>tfb_kumaraswamy</a></code>,
  <code><a href='tfb_masked_autoregressive_default_template.html'>tfb_masked_autoregressive_default_template</a></code>,
  <code><a href='tfb_masked_autoregressive_flow.html'>tfb_masked_autoregressive_flow</a></code>,
  <code><a href='tfb_masked_dense.html'>tfb_masked_dense</a></code>,
  <code><a href='tfb_matrix_inverse_tri_l.html'>tfb_matrix_inverse_tri_l</a></code>,
  <code><a href='tfb_matvec_lu.html'>tfb_matvec_lu</a></code>,
  <code><a href='tfb_normal_cdf.html'>tfb_normal_cdf</a></code>, <code><a href='tfb_ordered.html'>tfb_ordered</a></code>,
  <code><a href='tfb_permute.html'>tfb_permute</a></code>,
  <code><a href='tfb_power_transform.html'>tfb_power_transform</a></code>,
  <code><a href='tfb_real_nvp_default_template.html'>tfb_real_nvp_default_template</a></code>,
  <code><a href='tfb_reciprocal.html'>tfb_reciprocal</a></code>, <code><a href='tfb_reshape.html'>tfb_reshape</a></code>,
  <code><a href='tfb_scale_tri_l.html'>tfb_scale_tri_l</a></code>, <code><a href='tfb_sigmoid.html'>tfb_sigmoid</a></code>,
  <code><a href='tfb_sinh_arcsinh.html'>tfb_sinh_arcsinh</a></code>,
  <code><a href='tfb_softmax_centered.html'>tfb_softmax_centered</a></code>,
  <code><a href='tfb_softplus.html'>tfb_softplus</a></code>, <code><a href='tfb_softsign.html'>tfb_softsign</a></code>,
  <code><a href='tfb_square.html'>tfb_square</a></code>, <code><a href='tfb_tanh.html'>tfb_tanh</a></code>,
  <code><a href='tfb_transform_diagonal.html'>tfb_transform_diagonal</a></code>,
  <code><a href='tfb_transpose.html'>tfb_transpose</a></code>, <code><a href='tfb_weibull.html'>tfb_weibull</a></code></p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#see-also">See also</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sigrid Keydana.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


