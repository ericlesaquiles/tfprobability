<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Runs one step of the No U-Turn Sampler — mcmc_no_u_turn_sampler • tfprobability</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Runs one step of the No U-Turn Sampler — mcmc_no_u_turn_sampler" />
<meta property="og:description" content="The No U-Turn Sampler (NUTS) is an adaptive variant of the Hamiltonian Monte
Carlo (HMC) method for MCMC.  NUTS adapts the distance traveled in response to
the curvature of the target density.  Conceptually, one proposal consists of
reversibly evolving a trajectory through the sample space, continuing until
that trajectory turns back on itself (hence the name, 'No U-Turn').
This class implements one random NUTS step from a given
current_state.  Mathematical details and derivations can be found in
Hoffman &amp;amp; Gelman (2011)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tfprobability</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/dynamic_linear_models.html">Dynamic linear models</a>
    </li>
    <li>
      <a href="../articles/hamiltonian_monte_carlo.html">Multi-level modeling with Hamiltonian Monte Carlo</a>
    </li>
    <li>
      <a href="../articles/layer_dense_variational.html">Uncertainty estimates with layer_dense_variational</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rstudio/tfprobability/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Runs one step of the No U-Turn Sampler</h1>
    <small class="dont-index">Source: <a href='https://github.com/rstudio/tfprobability/blob/master/R/mcmc-kernels.R'><code>R/mcmc-kernels.R</code></a></small>
    <div class="hidden name"><code>mcmc_no_u_turn_sampler.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The No U-Turn Sampler (NUTS) is an adaptive variant of the Hamiltonian Monte
Carlo (HMC) method for MCMC.  NUTS adapts the distance traveled in response to
the curvature of the target density.  Conceptually, one proposal consists of
reversibly evolving a trajectory through the sample space, continuing until
that trajectory turns back on itself (hence the name, 'No U-Turn').
This class implements one random NUTS step from a given
<code>current_state</code>.  Mathematical details and derivations can be found in
Hoffman &amp; Gelman (2011).</p>
    </div>

    <pre class="usage"><span class='fu'>mcmc_no_u_turn_sampler</span>(
  <span class='no'>target_log_prob_fn</span>,
  <span class='no'>step_size</span>,
  <span class='kw'>max_tree_depth</span> <span class='kw'>=</span> <span class='fl'>10</span>,
  <span class='kw'>max_energy_diff</span> <span class='kw'>=</span> <span class='fl'>1000</span>,
  <span class='kw'>unrolled_leapfrog_steps</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>seed</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>name</span> <span class='kw'>=</span> <span class='kw'>NULL</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>target_log_prob_fn</th>
      <td><p>function which takes an argument like
<code>current_state</code> and returns its (possibly unnormalized) log-density under the target
distribution.</p></td>
    </tr>
    <tr>
      <th>step_size</th>
      <td><p><code>Tensor</code> or <code>list</code> of <code>Tensor</code>s representing the step
size for the leapfrog integrator. Must broadcast with the shape of
<code>current_state</code>. Larger step sizes lead to faster progress, but
too-large step sizes make rejection exponentially more likely. When
possible, it's often helpful to match per-variable step sizes to the
standard deviations of the target distribution in each variable.</p></td>
    </tr>
    <tr>
      <th>max_tree_depth</th>
      <td><p>Maximum depth of the tree implicitly built by NUTS. The
maximum number of leapfrog steps is bounded by <code>2**max_tree_depth</code> i.e.
the number of nodes in a binary tree <code>max_tree_depth</code> nodes deep. The
default setting of 10 takes up to 1024 leapfrog steps.</p></td>
    </tr>
    <tr>
      <th>max_energy_diff</th>
      <td><p>Scaler threshold of energy differences at each leapfrog,
divergence samples are defined as leapfrog steps that exceed this
threshold. Default to 1000.</p></td>
    </tr>
    <tr>
      <th>unrolled_leapfrog_steps</th>
      <td><p>The number of leapfrogs to unroll per tree
expansion step. Applies a direct linear multipler to the maximum
trajectory length implied by max_tree_depth. Defaults to 1.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>integer to seed the random number generator.</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>name prefixed to Ops created by this function.
Default value: <code>NULL</code> (i.e., 'nuts_kernel').</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a Monte Carlo sampling kernel</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>one_step</code> function can update multiple chains in parallel. It assumes
that a prefix of leftmost dimensions of <code>current_state</code> index independent
chain states (and are therefore updated independently).  The output of
<code>target_log_prob_fn(current_state)</code> should sum log-probabilities across all
event dimensions.  Slices along the rightmost dimensions may have different
target distributions; for example, <code>current_state[0][0, ...]</code> could have a
different target distribution from <code>current_state[0][1, ...]</code>.  These
semantics are governed by <code>target_log_prob_fn(*current_state)</code>.
(The number of independent chains is <code>tf$size(target_log_prob_fn(current_state))</code>.)</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    

<ul>
<li><p><a href='https://arxiv.org/pdf/1111.4246.pdf'>Matthew D. Hoffman, Andrew Gelman.  The No-U-Turn Sampler: Adaptively Setting Path Lengths in Hamiltonian Monte Carlo.  2011.</a></p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other mcmc_kernels: 
<code><a href='mcmc_dual_averaging_step_size_adaptation.html'>mcmc_dual_averaging_step_size_adaptation</a>()</code>,
<code><a href='mcmc_hamiltonian_monte_carlo.html'>mcmc_hamiltonian_monte_carlo</a>()</code>,
<code><a href='mcmc_metropolis_adjusted_langevin_algorithm.html'>mcmc_metropolis_adjusted_langevin_algorithm</a>()</code>,
<code><a href='mcmc_metropolis_hastings.html'>mcmc_metropolis_hastings</a>()</code>,
<code><a href='mcmc_random_walk_metropolis.html'>mcmc_random_walk_metropolis</a>()</code>,
<code><a href='mcmc_replica_exchange_mc.html'>mcmc_replica_exchange_mc</a>()</code>,
<code><a href='mcmc_simple_step_size_adaptation.html'>mcmc_simple_step_size_adaptation</a>()</code>,
<code><a href='mcmc_slice_sampler.html'>mcmc_slice_sampler</a>()</code>,
<code><a href='mcmc_transformed_transition_kernel.html'>mcmc_transformed_transition_kernel</a>()</code>,
<code><a href='mcmc_uncalibrated_hamiltonian_monte_carlo.html'>mcmc_uncalibrated_hamiltonian_monte_carlo</a>()</code>,
<code><a href='mcmc_uncalibrated_langevin.html'>mcmc_uncalibrated_langevin</a>()</code>,
<code><a href='mcmc_uncalibrated_random_walk.html'>mcmc_uncalibrated_random_walk</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='no'>predictors</span> <span class='kw'>&lt;-</span> <span class='no'>tf</span>$<span class='fu'>cast</span>( <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>201</span>,<span class='fl'>244</span>, <span class='fl'>47</span>,<span class='fl'>287</span>,<span class='fl'>203</span>,<span class='fl'>58</span>,<span class='fl'>210</span>,<span class='fl'>202</span>,<span class='fl'>198</span>,<span class='fl'>158</span>,<span class='fl'>165</span>,<span class='fl'>201</span>,<span class='fl'>157</span>,
  <span class='fl'>131</span>,<span class='fl'>166</span>,<span class='fl'>160</span>,<span class='fl'>186</span>,<span class='fl'>125</span>,<span class='fl'>218</span>,<span class='fl'>146</span>),<span class='no'>tf</span>$<span class='no'>float32</span>)</div><div class='output co'>#&gt; <span class='error'>Error in py_call_impl(callable, dots$args, dots$keywords): InternalError: CUDA runtime implicit initialization on GPU:0 failed. Status: out of memory</span>
#&gt; <span class='error'></span>
#&gt; <span class='error'>Detailed traceback: </span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/util/dispatch.py", line 180, in wrapper</span>
#&gt; <span class='error'>    return target(*args, **kwargs)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/ops/math_ops.py", line 787, in cast</span>
#&gt; <span class='error'>    x = ops.convert_to_tensor(x, name="x")</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/ops.py", line 1341, in convert_to_tensor</span>
#&gt; <span class='error'>    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 321, in _constant_tensor_conversion_function</span>
#&gt; <span class='error'>    return constant(v, dtype=dtype, name=name)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 262, in constant</span>
#&gt; <span class='error'>    allow_broadcast=True)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 270, in _constant_impl</span>
#&gt; <span class='error'>    t = convert_to_eager_tensor(value, ctx, dtype)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 95, in convert_to_eager_tensor</span>
#&gt; <span class='error'>    ctx.ensure_initialized()</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/eager/context.py", line 515, in ensure_initialized</span>
#&gt; <span class='error'>    context_handle = pywrap_tfe.TFE_NewContext(opts)</span></div><div class='input'><span class='no'>obs</span> <span class='kw'>&lt;-</span> <span class='no'>tf</span>$<span class='fu'>cast</span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>592</span>,<span class='fl'>401</span>,<span class='fl'>583</span>,<span class='fl'>402</span>,<span class='fl'>495</span>,<span class='fl'>173</span>,<span class='fl'>479</span>,<span class='fl'>504</span>,<span class='fl'>510</span>,<span class='fl'>416</span>,<span class='fl'>393</span>,<span class='fl'>442</span>,<span class='fl'>317</span>,<span class='fl'>311</span>,<span class='fl'>400</span>,
  <span class='fl'>337</span>,<span class='fl'>423</span>,<span class='fl'>334</span>,<span class='fl'>533</span>,<span class='fl'>344</span>),<span class='no'>tf</span>$<span class='no'>float32</span>)</div><div class='output co'>#&gt; <span class='error'>Error in py_call_impl(callable, dots$args, dots$keywords): InternalError: CUDA runtime implicit initialization on GPU:0 failed. Status: out of memory</span>
#&gt; <span class='error'></span>
#&gt; <span class='error'>Detailed traceback: </span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/util/dispatch.py", line 180, in wrapper</span>
#&gt; <span class='error'>    return target(*args, **kwargs)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/ops/math_ops.py", line 787, in cast</span>
#&gt; <span class='error'>    x = ops.convert_to_tensor(x, name="x")</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/ops.py", line 1341, in convert_to_tensor</span>
#&gt; <span class='error'>    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 321, in _constant_tensor_conversion_function</span>
#&gt; <span class='error'>    return constant(v, dtype=dtype, name=name)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 262, in constant</span>
#&gt; <span class='error'>    allow_broadcast=True)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 270, in _constant_impl</span>
#&gt; <span class='error'>    t = convert_to_eager_tensor(value, ctx, dtype)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 95, in convert_to_eager_tensor</span>
#&gt; <span class='error'>    ctx.ensure_initialized()</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/eager/context.py", line 515, in ensure_initialized</span>
#&gt; <span class='error'>    context_handle = pywrap_tfe.TFE_NewContext(opts)</span></div><div class='input'><span class='no'>y_sigma</span> <span class='kw'>&lt;-</span> <span class='no'>tf</span>$<span class='fu'>cast</span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>61</span>,<span class='fl'>25</span>,<span class='fl'>38</span>,<span class='fl'>15</span>,<span class='fl'>21</span>,<span class='fl'>15</span>,<span class='fl'>27</span>,<span class='fl'>14</span>,<span class='fl'>30</span>,<span class='fl'>16</span>,<span class='fl'>14</span>,<span class='fl'>25</span>,<span class='fl'>52</span>,<span class='fl'>16</span>,<span class='fl'>34</span>,<span class='fl'>31</span>,<span class='fl'>42</span>,<span class='fl'>26</span>,
  <span class='fl'>16</span>,<span class='fl'>22</span>),<span class='no'>tf</span>$<span class='no'>float32</span>)</div><div class='output co'>#&gt; <span class='error'>Error in py_call_impl(callable, dots$args, dots$keywords): InternalError: CUDA runtime implicit initialization on GPU:0 failed. Status: out of memory</span>
#&gt; <span class='error'></span>
#&gt; <span class='error'>Detailed traceback: </span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/util/dispatch.py", line 180, in wrapper</span>
#&gt; <span class='error'>    return target(*args, **kwargs)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/ops/math_ops.py", line 787, in cast</span>
#&gt; <span class='error'>    x = ops.convert_to_tensor(x, name="x")</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/ops.py", line 1341, in convert_to_tensor</span>
#&gt; <span class='error'>    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 321, in _constant_tensor_conversion_function</span>
#&gt; <span class='error'>    return constant(v, dtype=dtype, name=name)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 262, in constant</span>
#&gt; <span class='error'>    allow_broadcast=True)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 270, in _constant_impl</span>
#&gt; <span class='error'>    t = convert_to_eager_tensor(value, ctx, dtype)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 95, in convert_to_eager_tensor</span>
#&gt; <span class='error'>    ctx.ensure_initialized()</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/eager/context.py", line 515, in ensure_initialized</span>
#&gt; <span class='error'>    context_handle = pywrap_tfe.TFE_NewContext(opts)</span></div><div class='input'>
<span class='co'># Robust linear regression model</span>
<span class='no'>robust_lm</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='tfd_joint_distribution_sequential.html'>tfd_joint_distribution_sequential</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='fu'><a href='tfd_normal.html'>tfd_normal</a></span>(<span class='kw'>loc</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fl'>1</span>),
  <span class='co'># b0</span>
  <span class='fu'><a href='tfd_normal.html'>tfd_normal</a></span>(<span class='kw'>loc</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fl'>1</span>),
  <span class='co'># b1</span>
  <span class='fu'><a href='tfd_half_normal.html'>tfd_half_normal</a></span>(<span class='fl'>5</span>),
  <span class='co'># df</span>
  <span class='kw'>function</span>(<span class='no'>df</span>, <span class='no'>b1</span>, <span class='no'>b0</span>)
    <span class='fu'><a href='tfd_independent.html'>tfd_independent</a></span>(
      <span class='fu'><a href='tfd_student_t.html'>tfd_student_t</a></span>(
        <span class='co'># Likelihood</span>
        <span class='kw'>df</span> <span class='kw'>=</span> <span class='no'>df</span>[, <span class='kw'>NULL</span>],
        <span class='kw'>loc</span> <span class='kw'>=</span> <span class='no'>b0</span>[, <span class='kw'>NULL</span>] + <span class='no'>b1</span>[, <span class='kw'>NULL</span>] * <span class='no'>predictors</span>[<span class='kw'>NULL</span>,],
        <span class='kw'>scale</span> <span class='kw'>=</span> <span class='no'>y_sigma</span>[<span class='kw'>NULL</span>,]
      )
   )
 ),  <span class='kw'>validate_args</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; <span class='error'>Error in py_call_impl(callable, dots$args, dots$keywords): InternalError: CUDA runtime implicit initialization on GPU:0 failed. Status: out of memory</span>
#&gt; <span class='error'></span>
#&gt; <span class='error'>Detailed traceback: </span>
#&gt; <span class='error'>  File "&lt;decorator-gen-120&gt;", line 2, in __init__</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow_probability/python/distributions/distribution.py", line 332, in wrapped_init</span>
#&gt; <span class='error'>    default_init(self_, *args, **kwargs)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow_probability/python/distributions/normal.py", line 138, in __init__</span>
#&gt; <span class='error'>    loc, dtype=dtype, name='loc')</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow_probability/python/internal/tensor_util.py", line 115, in convert_nonref_to_tensor</span>
#&gt; <span class='error'>    value, dtype=dtype, dtype_hint=dtype_hint, name=name)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/ops.py", line 1283, in convert_to_tensor_v2</span>
#&gt; <span class='error'>    as_ref=False)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/ops.py", line 1341, in convert_to_tensor</span>
#&gt; <span class='error'>    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/tensor_conversion_registry.py", line 52, in _default_conversion_function</span>
#&gt; <span class='error'>    return constant_op.constant(value, dtype, name=name)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 262, in constant</span>
#&gt; <span class='error'>    allow_broadcast=True)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 270, in _constant_impl</span>
#&gt; <span class='error'>    t = convert_to_eager_tensor(value, ctx, dtype)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 95, in convert_to_eager_tensor</span>
#&gt; <span class='error'>    ctx.ensure_initialized()</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/eager/context.py", line 515, in ensure_initialized</span>
#&gt; <span class='error'>    context_handle = pywrap_tfe.TFE_NewContext(opts)</span></div><div class='input'>
 <span class='no'>log_prob</span> <span class='kw'>&lt;-</span><span class='kw'>function</span>(<span class='no'>b0</span>, <span class='no'>b1</span>, <span class='no'>df</span>) {<span class='no'>robust_lm</span> <span class='kw'>%&gt;%</span>
   <span class='fu'><a href='tfd_log_prob.html'>tfd_log_prob</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>b0</span>, <span class='no'>b1</span>, <span class='no'>df</span>, <span class='no'>obs</span>))}
 <span class='no'>step_size0</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Map</a></span>(<span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>tf</span>$<span class='fu'>cast</span>(<span class='no'>x</span>, <span class='no'>tf</span>$<span class='no'>float32</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>.2</span>, <span class='fl'>.5</span>))</div><div class='output co'>#&gt; <span class='error'>Error in py_call_impl(callable, dots$args, dots$keywords): InternalError: CUDA runtime implicit initialization on GPU:0 failed. Status: out of memory</span>
#&gt; <span class='error'></span>
#&gt; <span class='error'>Detailed traceback: </span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/util/dispatch.py", line 180, in wrapper</span>
#&gt; <span class='error'>    return target(*args, **kwargs)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/ops/math_ops.py", line 787, in cast</span>
#&gt; <span class='error'>    x = ops.convert_to_tensor(x, name="x")</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/ops.py", line 1341, in convert_to_tensor</span>
#&gt; <span class='error'>    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/tensor_conversion_registry.py", line 52, in _default_conversion_function</span>
#&gt; <span class='error'>    return constant_op.constant(value, dtype, name=name)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 262, in constant</span>
#&gt; <span class='error'>    allow_broadcast=True)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 270, in _constant_impl</span>
#&gt; <span class='error'>    t = convert_to_eager_tensor(value, ctx, dtype)</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/framework/constant_op.py", line 95, in convert_to_eager_tensor</span>
#&gt; <span class='error'>    ctx.ensure_initialized()</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/eager/context.py", line 515, in ensure_initialized</span>
#&gt; <span class='error'>    context_handle = pywrap_tfe.TFE_NewContext(opts)</span></div><div class='input'>
 <span class='no'>number_of_steps</span> <span class='kw'>&lt;-</span> <span class='fl'>100</span>
 <span class='no'>burnin</span> <span class='kw'>&lt;-</span> <span class='fl'>50</span>
 <span class='no'>nchain</span> <span class='kw'>&lt;-</span> <span class='fl'>50</span>

 <span class='no'>run_chain</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>() {
 <span class='co'># random initialization of the starting postion of each chain</span>
 <span class='no'>samples</span> <span class='kw'>&lt;-</span> <span class='no'>robust_lm</span> <span class='kw'>%&gt;%</span> <span class='fu'><a href='tfd_sample.html'>tfd_sample</a></span>(<span class='no'>nchain</span>)
 <span class='no'>b0</span> <span class='kw'>&lt;-</span> <span class='no'>samples</span><span class='kw'>[[</span><span class='fl'>1</span>]]
 <span class='no'>b1</span> <span class='kw'>&lt;-</span> <span class='no'>samples</span><span class='kw'>[[</span><span class='fl'>2</span>]]
 <span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='no'>samples</span><span class='kw'>[[</span><span class='fl'>3</span>]]

 <span class='co'># bijector to map contrained parameters to real</span>
 <span class='no'>unconstraining_bijectors</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
   <span class='fu'><a href='tfb_identity.html'>tfb_identity</a></span>(), <span class='fu'><a href='tfb_identity.html'>tfb_identity</a></span>(), <span class='fu'><a href='tfb_identity.html'>tfb_identity</a></span>(), <span class='fu'><a href='tfb_exp.html'>tfb_exp</a></span>())

 <span class='no'>trace_fn</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>pkr</span>) {
   <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>pkr</span>$<span class='no'>inner_results</span>$<span class='no'>inner_results</span>$<span class='no'>step_size</span>,
     <span class='no'>pkr</span>$<span class='no'>inner_results</span>$<span class='no'>inner_results</span>$<span class='no'>log_accept_ratio</span>)
 }

 <span class='no'>nuts</span> <span class='kw'>&lt;-</span> <span class='fu'>mcmc_no_u_turn_sampler</span>(
   <span class='kw'>target_log_prob_fn</span> <span class='kw'>=</span> <span class='no'>log_prob</span>,
   <span class='kw'>step_size</span> <span class='kw'>=</span> <span class='no'>step_size0</span>
   ) <span class='kw'>%&gt;%</span>
   <span class='fu'><a href='mcmc_transformed_transition_kernel.html'>mcmc_transformed_transition_kernel</a></span>(<span class='kw'>bijector</span> <span class='kw'>=</span> <span class='no'>unconstraining_bijectors</span>) <span class='kw'>%&gt;%</span>
   <span class='fu'><a href='mcmc_dual_averaging_step_size_adaptation.html'>mcmc_dual_averaging_step_size_adaptation</a></span>(
     <span class='kw'>num_adaptation_steps</span> <span class='kw'>=</span> <span class='no'>burnin</span>,
     <span class='kw'>step_size_setter_fn</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>pkr</span>, <span class='no'>new_step_size</span>)
       <span class='no'>pkr</span>$<span class='fu'>`_replace`</span>(
         <span class='kw'>inner_results</span> <span class='kw'>=</span> <span class='no'>pkr</span>$<span class='no'>inner_results</span>$<span class='fu'>`_replace`</span>(<span class='kw'>step_size</span> <span class='kw'>=</span> <span class='no'>new_step_size</span>)),
     <span class='kw'>step_size_getter_fn</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>pkr</span>) <span class='no'>pkr</span>$<span class='no'>inner_results</span>$<span class='no'>step_size</span>,
     <span class='kw'>log_accept_prob_getter_fn</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>pkr</span>) <span class='no'>pkr</span>$<span class='no'>inner_results</span>$<span class='no'>log_accept_ratio</span>
     )

   <span class='no'>nuts</span> <span class='kw'>%&gt;%</span> <span class='fu'><a href='mcmc_sample_chain.html'>mcmc_sample_chain</a></span>(
     <span class='kw'>num_results</span> <span class='kw'>=</span> <span class='no'>number_of_steps</span>,
     <span class='kw'>num_burnin_steps</span> <span class='kw'>=</span> <span class='no'>burnin</span>,
     <span class='kw'>current_state</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>b0</span>, <span class='no'>b1</span>, <span class='no'>df</span>),
     <span class='kw'>trace_fn</span> <span class='kw'>=</span> <span class='no'>trace_fn</span>)
   }

   <span class='no'>run_chain</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>tensorflow</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/tensorflow/man/tf_function.html'>tf_function</a></span>(<span class='no'>run_chain</span>)
   <span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'>run_chain</span>()</div><div class='output co'>#&gt; <span class='error'>Error in py_call_impl(callable, dots$args, dots$keywords): InternalError: CUDA runtime implicit initialization on GPU:0 failed. Status: out of memory</span>
#&gt; <span class='error'></span>
#&gt; <span class='error'>Detailed traceback: </span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/eager/def_function.py", line 562, in __call__</span>
#&gt; <span class='error'>    context.ensure_initialized()</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/eager/context.py", line 1716, in ensure_initialized</span>
#&gt; <span class='error'>    context().ensure_initialized()</span>
#&gt; <span class='error'>  File "/home/key/.virtualenvs/tf2.2/lib64/python3.7/site-packages/tensorflow/python/eager/context.py", line 515, in ensure_initialized</span>
#&gt; <span class='error'>    context_handle = pywrap_tfe.TFE_NewContext(opts)</span></div><div class='input'># }
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sigrid Keydana.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


